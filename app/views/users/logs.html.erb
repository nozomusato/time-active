<% provide(:title, @user.name) %>
<div>
  <table class="table table-bordered table-condensed user-table">
    <tr>
      <td>名前：<%= @user.name %></td>
    </tr>
    <tr>
      <td>履歴数：<%= @plans.count %></td>
    </tr>
  </table>
</div>

<div>
  <table class="table table-bordered table-condensed table-hover" id="table-attendances">
    <thead>
      
      <%= pie_chart @chart_2 %>
    </thead>
    
    <%= link_to "CSV出力", csv_dl_path(format: :csv), class: "btn btn-primary", method: :post %>
    
    <tbody>
      <tr>
        <th>メニュー</th>
        <th>開始時間</th>
        <th>終了時間</th>
        <th>合計時間</th>
        <th>メモ</th>
        <th>編集</th>
        <th>削除</th>
      </tr>
    </tbody>
    
    <tfoot>
      <% @plans.each do |plan|%>
      <tr>
        <td><%=plan.menu %></td>
        <td><%= plan.created_at.strftime("%Y年%m月%d日 %H:%M")%></td>
        <td><%= plan.finished_at.strftime("%Y年%m月%d日 %H:%M") if plan.finished_at.present? %></td>
        <td>
          <% if plan.created_at.present? && plan.finished_at.present? %>
          <%= working_times(plan.created_at, plan.finished_at) %>
          <% seconds = (plan.finished_at - plan.created_at).to_i %>
          <% @total_seconds = @total_seconds.to_i + seconds %>
          <% else plan.created_at.present? && plan.finished_at.nil? %>
          <%= working_times(plan.created_at, Time.current) %>
          <% end %>
        </td>
        <td><%= plan.note%></td>
        <td><%= link_to "編集", edit_plan_path(plan), remote: true,class: "btn btn-success" %></td>
        <td><%= link_to "削除", plan, method: :delete,
                data: { confirm: "削除してよろしいですか？" }, class: "btn btn-danger" %></td>
      </tr>
      <% end %>
      
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td><%=@plans.count%></td>
        <td></td>
        <td></td>
        <td><%= working_times_sum(@total_seconds) unless @total_seconds.nil? %></td>
        <td></td>
        <td></td>
        <td><%= @time_sum %></td>
        <td></td>
      </tr>
    </tfoot>
    
  </table>
</div>

<!--モーダルウインドウ表示-->
<div id="edit" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>

